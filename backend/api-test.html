<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>API Auth Test</title>
</head>

<body>
    <h1>Register User</h1>
    <form id="registerForm">
        <input type="text" name="name" placeholder="Name" required><br><br>
        <input type="email" name="email" placeholder="Email" required><br><br>
        <input type="password" name="password" placeholder="Password" required><br><br>
        <button type="submit">Register</button>
    </form>

    <h1>Login User</h1>
    <form id="loginForm">
        <input type="email" name="email" placeholder="Email" required><br><br>
        <input type="password" name="password" placeholder="Password" required><br><br>
        <button type="submit">Login</button>
    </form>

    <h1>Call Protected Route</h1>
    <form id="protectedForm">
        <input type="text" id="tokenInput" placeholder="Paste your JWT token here" required
            style="width:400px;"><br><br>
        <button type="submit">Call Protected /me</button>
    </form>

    <h2>Response</h2>
    <pre id="responseBox"></pre>

    <h2>Protected Route Response</h2>
    <pre id="protectedResponse"></pre>

    <script>
        const registerForm = document.getElementById('registerForm');
        const loginForm = document.getElementById('loginForm');
        const protectedForm = document.getElementById('protectedForm');
        const responseBox = document.getElementById('responseBox');
        const protectedResponse = document.getElementById('protectedResponse');

        const apiBase = 'http://localhost:5000/api/auth'; // Adjust if needed
        const protectedBase = 'http://localhost:5000/api/test'; // Adjust if needed

        async function handleSubmit(form, endpoint) {
            form.addEventListener('submit', async function (e) {
                e.preventDefault();

                const formData = new FormData(form);
                const data = Object.fromEntries(formData.entries());

                try {
                    const res = await fetch(`${apiBase}/${endpoint}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(data)
                    });

                    const json = await res.json();
                    responseBox.textContent = JSON.stringify(json, null, 2);
                } catch (err) {
                    responseBox.textContent = 'Error: ' + err;
                }
            });
        }

        registerForm && handleSubmit(registerForm, 'register');
        loginForm && handleSubmit(loginForm, 'login');

        // Handle protected route call
        protectedForm.addEventListener('submit', async function (e) {
            e.preventDefault();

            const token = document.getElementById('tokenInput').value.trim();
            if (!token) {
                protectedResponse.textContent = 'Please enter a JWT token!';
                return;
            }

            try {
                const res = await fetch(`${protectedBase}/me`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const data = await res.json();

                if (!res.ok) {
                    protectedResponse.textContent = `Error: ${data.message || res.statusText}`;
                } else {
                    protectedResponse.textContent = JSON.stringify(data, null, 2);
                }
            } catch (err) {
                protectedResponse.textContent = 'Fetch error: ' + err.message;
            }
        });
    </script>
</body>

</html>